<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Тестирование работы палитры</title>

    <link rel="Stylesheet" type="text/css" href="vendor/jpicker-1.1.6/css/jPicker-1.1.6.min.css"/>
    <link rel="Stylesheet" type="text/css" href="vendor/jpicker-1.1.6/jPicker.css"/>

    <!--<script src="bower_components/jquery/dist/jquery.min.js"></script>-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="vendor/jpicker-1.1.6/jpicker-1.1.6.min.js"></script>
</head>
<body>

<form>
    <input type="text" name="c_text_1" value=""><br>
    <input type="text" name="c_text_2" value="#F4D"><br>
    <input type="text" name="c_text_3" value="#f84900"><br>
    <input type="text" name="c_text_4" value="rgb(101, 102, 103)"><br>
    <input type="text" name="c_text_5" value="RGBA(104, 105, 106, 0.8)"><br>
    <input type="text" name="c_text_6" value="RGBA(jlsdfj, 105, 106, 0.8)"><br>
</form>

<script>
    jQuery(function ($) {
        var textExtendWithColor = ['c_text_1', 'c_text_2', 'c_text_3', 'c_text_4', 'c_text_5', 'c_text_6'];

        for (var inputName in textExtendWithColor) {
            var input = $("form input[name='" + textExtendWithColor[inputName] + "']");
            if (input.length) {
                var color = convertColorValue(input.val());
                if (color) {
                    color = new $.jPicker.Color(color);
                } else {
                    color = new $.jPicker.Color();
                }
                var span = $("<span>").insertAfter(input);
                span.jPicker(
                        {
                            window: {
                                expandable: true,
                                position: {
                                    y: '0px'
                                },
                                alphaSupport: true
                            },
                            images: {
                                clientPath: 'vendor/jpicker-1.1.6/images/'
                            },
                            color: {
                                alphaSupport: true,
                                active: color
                            }
                        },
                        function (color, context) {
                            var hex = color.val('hex');
                            $(this).prev().val('#' + hex);
                        }
                );

                input.data('jPicker', span);

                input.keyup(function () {
                    var color = convertColorValue($(this).val());
                    if (color) {
                        for (var cName in color) {
                            $(this).data('jPicker')[0].color.active.val(cName, color[cName], this);
                            if (cName == 'hex') {
                                $(this).data('jPicker')[0].color.active.val('a', '255', this);
                            }
                        }
                    } else {
                        $(this).data('jPicker')[0].color.active.val('r', '0', this);
                        $(this).data('jPicker')[0].color.active.val('g', '0', this);
                        $(this).data('jPicker')[0].color.active.val('b', '0', this);
                        $(this).data('jPicker')[0].color.active.val('a', '0', this);
                    }
                });
            }
        }

        function convertColorValue(val) {
            var colorPatterns = {
                hash: /^\s*#([0-F]{6})\s*$/i,
                shortHash: /^\s*#([0-F])([0-F])([0-F])\s*$/i,
                rgb: /^\s*rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)\s*$/i,
                rgba: /^\s*rgba\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]{1,5})\s*\)\s*$/i
            };

            var numberDetected = false;

            for (var patternName in colorPatterns) {
                var matches = val.match(colorPatterns[patternName]);
                if (matches) {
                    switch (patternName) {
                        case 'hash':
                            numberDetected = {hex: matches[1]};
                            break;
                        case 'shortHash':
                            numberDetected = {hex: matches[1] + matches[1] + matches[2] + matches[2] + matches[3] + matches[3]};
                            break;
                        case 'rgb':
                            numberDetected = {r: matches[1], g: matches[2], b: matches[3]};
                            break;
                        case 'rgba':
                            numberDetected = {r: matches[1], g: matches[2], b: matches[3], a: matches[4] * 255};
                            break;
                        default:
                            break;
                    }

                    break;
                }
            }

            return numberDetected;
        }


        $("#c_color").change(function () {
            $("#c_text").val($(this).val());
        });
        $("#c_text").change(function () {
            console.log($(this).val());
            $("#c_color").val($(this).val());
        });
    });
</script>

</body>
</html>